<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Devblog - Phaser: Endless Jumper y Repite</title>
      <meta name="viewport" content="width=device-width">

      <!-- syntax highlighting CSS -->
      <link rel="stylesheet" href="/taller-creacion-de-videojuegos/css/syntax.css">

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/taller-creacion-de-videojuegos/css/main.css">

      <!-- Responsive CSS -->
      <link rel="stylesheet" href="/taller-creacion-de-videojuegos/css/responsive.css">

      <!-- Google Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div class="site">
      <div class="sidebar" id="sidebar">
        <div class="header">
          <h1 class="title"><a href="/taller-creacion-de-videojuegos/"><img id="logo" src="/taller-creacion-de-videojuegos/images/logo.png"></a></h1>
          <span class="tagline">Devblog</span>
        </div>
        <div class="posts">
          <ul class="posts-list">
            
              <li class="post-link">
                <a class="post-title" href="/taller-creacion-de-videojuegos/posts/2016/03/13/pahser-endless-jumper-y-repite.html">
                  <span class="post-date">13 Mar 2016</span>
                  Phaser: Endless Jumper y Repite
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/taller-creacion-de-videojuegos/posts/2016/03/13/endless-jumper.html">
                  <span class="post-date">13 Mar 2016</span>
                  Endless Jumper
                </a>
              </li>
            
              <li class="post-link">
                <a class="post-title" href="/taller-creacion-de-videojuegos/posts/2016/03/07/bienvenidos.html">
                  <span class="post-date">07 Mar 2016</span>
                  Bienvenidos
                </a>
              </li>
            
          </ul>
        </div>
        <div class="footer">
          <span id="footer-links">
            <a href="http://mammut.github.com" target="_blank" class="footer-link">About</a> <span class="separator">&bull;</span>
            <a href="http://twitter.com/jpescalonag" target="_blank" class="footer-link">Twitter</a> <span class="separator">&bull;</span>
            <a href="http://github.com/mammut" target="_blank" class="footer-link">GitHub</a>
          </span>
        </div>
      </div>

        <div class="content" id="home">
  <div id="sidebar-button">
    <img src="/taller-creacion-de-videojuegos/images/sidebar-button.png">
  </div>
  <div id="post-info">
    <div id="cover-photo-container">
      <img id="cover-photo" src="/taller-creacion-de-videojuegos/images/2016-03-13.jpg">
    </div>
    <div id="info-container">
      <h1 id="title">Phaser: Endless Jumper y Repite</h1>
      <span id="date">13 Mar 2016</span>
    </div>
  </div>

  <div class="post">
    <h2 id="probando-phaser">Probando Phaser</h2>

<p>Lo primero que hice para aprender Phaser fue seguir el tutorial de principiantes, donde explican a rasgos generales como utilizar el framework. Explican principalmente el funcionamiento del Preloader, Create y Update, funciones que forman parte del ciclo de un juego.</p>

<ul>
  <li>En Preload se cargan los assets necesarios para el juego (imágenes, sonidos, tiles, etc).</li>
  <li>En Create se crean los objetos del mundo del juego, plataformas, personajes, etc.</li>
  <li>En Update se actualiza constantemente el estado del juego, movimientos, colisiones, etc.</li>
</ul>

<p>Leyendo otros tutoriales y ejemplos descubrí una forma diferente de programar el juego utilizando Herencia en JS (herencia de prototipos, no de clases). Es un poco mas complicada que utilizando el objeto literal, pero el código queda mas estructurado y la ocultación de los objetos del juego es mas limpia que hacer la típica <strong>immediately invoked function</strong>.</p>

<p>La diferencia es:</p>

<h3 id="ejemplo-utilizando-objetos-literales">Ejemplo utilizando objetos literales</h3>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Game</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">AUTO</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="p">{</span> 
    <span class="na">preload</span><span class="p">:</span> <span class="nx">preload</span><span class="p">,</span>
    <span class="na">create</span><span class="p">:</span> <span class="nx">create</span><span class="p">,</span>
    <span class="na">update</span><span class="p">:</span> <span class="nx">update</span> 
    <span class="c1">// todo es referenciado utilizando game</span>
    <span class="p">...</span>
<span class="p">});</span>
</code></pre>
</div>
<p> </p>

<h3 id="ejemplo-utilizando-herencia-de-prototipos">Ejemplo utilizando herencia de prototipos</h3>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Jumper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
<span class="nx">Jumper</span><span class="p">.</span><span class="nx">Play</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>

<span class="nx">Jumper</span><span class="p">.</span><span class="nx">Play</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">preload</span><span class="p">:</span> <span class="nx">preload</span><span class="p">,</span>
    <span class="na">create</span><span class="p">:</span> <span class="nx">create</span><span class="p">,</span>
    <span class="na">update</span><span class="p">:</span> <span class="nx">update</span> 
    <span class="c1">// todo es referenciado utilizando this</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Game</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">CANVAS</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
</code></pre>
</div>

<p>Por experiencia previa en JavaScript opte por hacer mis juegos en el segundo formato.</p>

<h2 id="endles-jumper">Endles Jumper</h2>

<p><a href="http://gamejolt.com/games/endless-jumper/133143">Endless Jumper</a>: La idea original es del juego <a href="http://www.ferryhalim.com/orisinal/g3/bells.htm">Winterbells</a>, un endless jumper en que solo es posible avanzar hacia arriba a medida que se van tocando las campanitas.</p>

<p>Este juego es un arcade el cual involucra física, en especifico gravedad y colisiones. Phaser incluye tres tipos de físicas y es muy sencillo de inicializar. Muy bueno en ese aspecto.</p>

<p>Phaser da la posibilidad de crear grupos de objetos o elementos, por ejemplo el grupo de estrellas, el cual colisiona con el Player. Esto es una gran ventaja, pues para indicarle al juego que las estrellas deben colisionar con el jugador no es necesario indicarle a cada estrella individualmente, si no basta con el grupo estrella, luego cualquier elemento del grupo colisiona con el Player automáticamente.</p>

<p>La principal dificultad del juego fue el movimiento infinito vertical y el manejo de las estrellas (aparecer y desaparecer).</p>

<p>Para el movimiento infinito vertical se utiliza una mezcla de <em>Bounds</em> y <em>Wrap</em>. El mundo en el eje vertical queda fijo con respecto al player. En el eje x tiene un wrap (si sale por la derecha, aparece por la izquierda).</p>

<p>Para la generación de estrellas encontré un ejemplo de un sistema similar (a lo flappy bird) en que utiliza elementos <em>vivos</em> y <em>muertos</em> (<code class="highlighter-rouge">elem.kill()</code>)
Luego cuando salían las estrellas de la vista, o cuando el player lo tocaba, quedaba en la lista de elementos muertos. Luego en el update, volvía a crear el elemento por sobre la vista de la cámara actual, distribuido equitativamente.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">stars</span><span class="p">.</span><span class="nx">forEachAlive</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// eliminar elementos fuera de la camara</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span>
         <span class="c1">// Crear arriba</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">starsCreateOne</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rnd</span><span class="p">.</span><span class="nx">integerInRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">world</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">50</span><span class="p">),</span>  <span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">50</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</code></pre>
</div>

<p>Phaser es una excelente opción para crear juegos tipo arcade, pues incluye muchas implementaciones elementos de física (gravedad, colisiones, teclados, camaras, etc).</p>

<h3 id="repite">Repite</h3>

<p>Este juego no es un arcade, sino un tipo memorice, donde el jugador debe observar una secuencia de luces para luego repetirla. Al repetirla correctamente, la secuencia crece en una luz.</p>

<p>No fue necesario utilizar física en este juego, y la lógica del juego en general es bastante sencilla, solo se agrega un numero del botón al azar a una lista de números (la secuencia) y luego se escucha la secuencia del usuario, si cambia en algo este pierde.</p>

<p>La mayor dificultad fue el parpadeo de las luces, pero en los ejemplos de Phaser había un ejemplo similar de como crear parpadeos. Utilizaban diferencias de tiempo para luego en un tiempo futuro en otro update cambiar el <em>alpha</em> del botón.</p>

<h2 id="veredicto">Veredicto</h2>

<p>Phaser es una excelente libreria en JavaScript para crear juegos, la API esta bien documentada, hay muchisimos ejemplos y recursos para aprender, la comunidad es grande. Por otro lado es necesario tener un nivel descente de JavaScript, en especial cuando se refiere al scope, el tipico problema de:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">works</span><span class="p">();</span> <span class="c1">// no funciona</span>
<span class="p">},</span> <span class="mi">400</span><span class="p">);</span>
</code></pre>
</div>

<p>vs</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">works</span><span class="p">()</span> <span class="c1">// funciona</span>
<span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">400</span><span class="p">);</span>
</code></pre>
</div>

  </div>
  <div class="colophon">
    <p>
      <span id="pub-date">Publicado el 13 Mar 2016</span> <span class="separator">&bull;</span>
      <span id="social">Encuentrame en <a href="http://twitter.com/jpescalonag" target="_blank">Twitter</a>!</span>
    </p>
  </div>
</div>



    </div>
    <script src="/taller-creacion-de-videojuegos/scripts/responsive.js" type="text/javascript"></script>
  </body>
</html>
